import{T as $}from"./TextInput.1279f06a.js";import{_ as o}from"./Translate.dc83ae5b.js";import{b as H}from"./index.esm.7b4e3ded.js";import{c as _}from"./index.esm.1ebb3f74.js";import{a as M,b as j}from"./index.esm.c83f593c.js";import{Q as x}from"./react-toastify.esm.f871cad9.js";import{r as a,b as S,d as w,j as r,a as t,f as E}from"./app.3915f664.js";import F from"./TipPopup.6ff8d1fd.js";import{S as I}from"./SecondaryButton.1822c416.js";import{K as L}from"./react-tooltip.esm.min.7e156490.js";/* empty css                      */import"./iconBase.581190ba.js";import"./PrimaryButton.4515b3b5.js";import"./Modal.eab9d03c.js";import"./transition.d0efdae9.js";import"./InputLabel.5ee1418c.js";import"./Textarea.989b4f4b.js";import"./NumberInput.67f3963f.js";function oe({streamer:i,forceScroll:b=!1}){const[p,d]=a.exports.useState([]),[m,h]=a.exports.useState(""),[N,u]=a.exports.useState(!1),[P,v]=a.exports.useState(0),{auth:g,pusher:z}=S().props,{coins_sound:y}=S().props,C=new Audio(y),n=a.exports.useRef(),f=`room-${i.username}`,k=e=>{const s=e.scrollTop+e.clientHeight;s==e.scrollHeight?u(!1):u(!0),v(s)},c=()=>{var e;if(!N){const{offsetHeight:s,scrollHeight:l,scrollTop:A}=n.current;(e=n.current)==null||e.scrollTo(0,l)}};a.exports.useEffect(()=>{c()},[p]),a.exports.useEffect(()=>{w.get(route("chat.latestMessages",{roomName:f})).then(e=>{d(e.data)}).catch(e=>x.error(`Loading latest messages: ${e.message}`)),window.Echo.channel(f).listen(".livechat",e=>{d(s=>[...s,e.chat]),e.chat.tip>0&&C.play()}),b&&c()},[]);const T=e=>{e.preventDefault(),w.post(route("chat.sendMessage",{user:i.id}),{message:m}).then(()=>h("")).catch(s=>{var l;x.error((l=s.response.data)==null?void 0:l.message)}),c()};return r("div",{className:"flex flex-col w-full lg:w-[400px] h-[270px] sm:h-[360px] lg:h-[536px] bg-white dark:bg-zinc-900 dark:border-zinc-900 ",children:[r("div",{ref:n,onScroll:e=>k(e.currentTarget),className:"flex-grow  text-gray-700 text-sm dark:text-white pl-2  relative overflow-scroll",children:[r("h3",{className:"font-semibold pt-5 text-lg flex items-center justify-center",children:[t(H,{className:"mr-2"}),o("Live Chat")]}),p.map(e=>r("p",{className:`py-2 ${e.tip>0&&"bg-yellow-200 rounded-lg p-2 text-gray-900 my-2"}`,children:[e.user_id===i.id&&t("span",{children:t(_,{"data-tooltip-content":o("Channel Owner"),"data-tooltip-id":`chatmsg-follower-${e.id}`,className:"-mt-0.5 mr-1 inline text-pink-600"})}),e.isFollower&&t("span",{children:t(M,{"data-tooltip-content":o("Channel Follower"),"data-tooltip-id":`chatmsg-follower-${e.id}`,className:"mr-1 inline text-cyan-600"})}),e.isSubscriber&&t("span",{children:t(j,{"data-tooltip-content":o("Channel Subscriber"),"data-tooltip-id":`chatmsg-subscriber-${e.id}`,className:"mr-1 inline text-fuchsia-500"})}),t(L,{anchorSelect:"svg"}),r("span",{className:`font-semibold ${e.user_id===i.id?"text-pink-600":"text-indigo-500 dark:text-indigo-400"}`,children:[e.user.username,": "]}),e.tip>0&&o("Just tipped :tip tokens! ",{tip:e.tip}),t("span",{className:"break-all",children:e.message})]},`msg-${e.id}`))]}),r("div",{className:"py-5 px-2 flex items-center",children:[r("div",{className:"mr-2 flex-grow",children:[g.user&&t("form",{onSubmit:T,children:t($,{name:"chat_message",className:"w-full",placeholder:o("Enter message & press enter"),value:m,handleChange:e=>h(e.target.value)})}),!g.user&&t(I,{className:"w-full py-3",onClick:e=>E.Inertia.visit(route("login")),children:o("Login to Chat")})]}),t("div",{children:t(F,{streamer:i})})]})]})}export{oe as default};
